<div class="form-group">
  <%= form.label :name, "Deploy stage name", class: "col-lg-2 control-label" %>
  <div class="col-lg-4">
    <%= form.text_field :name, class: "form-control" %>
  </div>
</div>

<div class="form-group">
  <%= form.label :notify_email_address, "Notify this email address of deploys", class: "col-lg-2 control-label" %>
  <div class="col-lg-4">
    <%= form.text_field :notify_email_address, class: "form-control" %>
  </div>
</div>

<fieldset>
  <legend>Commands</legend>
  <p>Select the commands you want to run when executing this stage.</p>

  <div id="commands" class="form-group">
    <%= form.collection_check_boxes(:command_ids, @stage.all_commands, :id, :command) do |b| %>
      <div class="row">
        <div data-id="<%= b.value %>" class="col-lg-2">
          <span class="checkbox">
            <%= b.check_box %>
          </span>
        </div>
        <div class="col-lg-6">
          <pre><%= b.text %></pre>
        </div>
      </div>
    <% end %>

      <hr />

      <%= form.text_area :command, class: "form-control", rows: 4, value: nil, placeholder: 'cap production deploy' %>

  </div>
</fieldset>

<fieldset>
  <legend>Flowdock flows</legend>
  <p>Add the name and API token of the Flowdock flow which should be notified of deploys.</p>

  <%= form.fields_for :flowdock_flows do |flow_fields| %>
    <div class="form-group">
      <div class="col-lg-2 col-lg-offset-2">
        <%= flow_fields.text_field :name, class: "form-control", placeholder: "Flow name" %>
      </div>

      <div class="col-lg-4">
        <%= flow_fields.text_field :token, class: "form-control", placeholder: "Token" %>
      </div>

      <% if flow_fields.object.persisted? %>
        <div class="col-lg-1 checkbox">
          <%= flow_fields.check_box :_destroy if flow_fields.object.persisted? %>
          <%= flow_fields.label :_destroy, "Delete" %>
        </div>
      <% end %>
    </div>
  <% end %>
</fieldset>

<%= javascript_tag do %>
  $(document).ready(function() {
    $('#commands').sortable({ items: '.checkbox' });
  });
<% end %>
